epicsEnvSet("ASYN","/epics/support/asyn")
epicsEnvSet("MODBUS","/epics/support/modbus")
epicsEnvSet("STREAMDEVICE","/epics/support/StreamDevice")
## Register all support components
dbLoadDatabase "../../dbd/templatedmodbus.dbd"
templatedmodbus_registerRecordDeviceDriver(pdbbase)
# Configure Modbus TCP communication
drvAsynIPPortConfigure("MODBUS_IP", "192.168.1.100:502", 0, 0, 0)
modbusInterposeConfig("MODBUS_IP", 0, 0, 0)
# Define Modbus ports
drvModbusAsynConfigure("MODBUS_AI", "MODBUS_IP", 1, 4, 0, 10, 0, 1000, "GenericDevice")
drvModbusAsynConfigure("MODBUS_AO", "MODBUS_IP", 1, 6, 0, 2, 0, 1000, "GenericDevice")
drvModbusAsynConfigure("MODBUS_DI", "MODBUS_IP", 1, 2, 0, 8, 0, 1000, "GenericDevice")
drvModbusAsynConfigure("MODBUS_DO", "MODBUS_IP", 1, 5, 0, 8, 0, 1000, "GenericDevice")
# Load database records
dbLoadRecords("$(TOP)/db/modbusDevice.db", "P=MODBUS,R=Device")
dbl
dbgf PS:LAB:PS1:current_rb
dbgf PS:LAB:PS1:state_standby
dbgf PS:LAB:PS1:state_remote
dbgf PS:LAB:PS1:state_power_on
dbl
dbpf PS:LAB:PS1:cmd "Power On"
dbgf PS:LAB:PS1:state_raw
dbgf PS:LAB:PS1:current_raw_rb
dbgf PS:LAB:PS1:current_raw_rb
dbgf PS:LAB:PS1:current_raw_rb
dbpf PS:LAB:PS1:state_raw.PROC 1
dbgf PS:LAB:PS1:state_raw
dbgf PS:LAB:PS1:state_raw
dbgf PS:LAB:PS1:state_raw
dbpf PS:LAB:PS1:current_raw_rb.PROC 1
dbgf PS:LAB:PS1:current_raw_rb
dbgf PS:LAB:PS1:current_raw_rb
dbpf PS:LAB:PS1:cmd 2
dbpf PS:LAB:PS1:cmd 0
dbgf PS:LAB:PS1:state_raw
dbpf PS:LAB:PS1:cmd 1
dbgf PS:LAB:PS1:state_raw
dbgf PS:LAB:PS1:state_raw
dbgf PS:LAB:PS1:current_raw_rb
dbpf PS:LAB:PS1:cmd 
dbl
dbpf PS:LAB:PS1:cmd 0x1
dbgf PS:LAB:PS1:state_raw
dbl
dbgf PS:LAB:PS1:state_remote
dbl
dbgf PS:LAB:PS1:CustomerNumber
dbgf PS:LAB:PS1:ProjectCode
dbl
dbgf PS:LAB:PS1:CustomerNumber
dbgf PS:LAB:PS1:ProjectCode
